<!DOCTYPE html>
<!-- By Manzik: Mohsen Yousefian -->
<html>
<head>
    <title>Cuboids | Manzik lab</title>
    <script src="/js/lab.js"></script>
    <meta charset="us-ascii" />
    <script src="http://manzik.co/js/ask.js"></script>
    <script>
        (function (i, s, o, g, r, a, m)
        {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function ()
            {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-52938764-1', 'auto');
        ga('send', 'pageview');

    </script>
    <script src="dat.gui.min.js"></script>
    <script>
        function rect(x, y)
        {
            this.x = x;
            this.y = y;
            this.c = g_color();
        }
        var o = [];
        var cc = new rect(innerWidth / 2, innerHeight / 2);
        function u()
        {
            this.c1 = [0, 0, 0, 0];
        }
        var a = 80;
        var imgd;

        function u()
        {
            if (localStorage)
                if (localStorage.getItem("Cuboids_0"))
                {
                    this.color0 = localStorage.getItem("Cuboids_0");
                }
                else
                {
                    this.color0 = "#0000FF";
                    localStorage.setItem("Cuboids_0", "#0000FF");
                }
            else
                if (window.localStorage.getItem("Cuboids_0"))
                    this.color0 = window.localStorage.getItem("Cuboids_0");
                else
                {
                    this.color0 = "#0000FF";
                    window.localStorage.setItem("Cuboids_0", "#0000FF");
                }
            if (localStorage)
                if (localStorage.getItem("Cuboids_1"))
                {
                    this.color1 = localStorage.getItem("Cuboids_1");
                }
                else
                {
                    this.color1 = "#00fff0";
                    localStorage.setItem("Cuboids_1", "#00fff0");
                }
            else
                if (window.localStorage.getItem("Cuboids_1"))
                    this.color1 = window.localStorage.getItem("Cuboids_1");
                else
                {
                    this.color1 = "#00fff0";
                    window.localStorage.setItem("Cuboids_1", "#00fff0");
                }

            if (localStorage)
                if (localStorage.getItem("Cuboids_2"))
                {
                    this.color2 = localStorage.getItem("Cuboids_2");
                }
                else
                {
                    this.color2 = "#00fff0";
                    localStorage.setItem("Cuboids_2", "#00fff0");
                }
            else
                if (window.localStorage.getItem("Cuboids_2"))
                    this.color2 = window.localStorage.getItem("Cuboids_2");
                else
                {
                    this.color2 = "#00fff0";
                    window.localStorage.setItem("Cuboids_2", "#00fff0");
                }

            if (localStorage)
                if (localStorage.getItem("Cuboids_3"))
                {
                    this.color3 = localStorage.getItem("Cuboids_3");
                }
                else
                {
                    this.color3 = "rgba(255,255,255,0.01)";
                    localStorage.setItem("Cuboids_3", "rgba(255,255,255,0.01)");
                }
            else
                if (window.localStorage.getItem("Cuboids_3"))
                    this.color3 = window.localStorage.getItem("Cuboids_3");
                else
                {
                    this.color3 = "rgba(255,255,255,0.01)";
                    window.localStorage.setItem("Cuboids_3", "rgba(255,255,255,0.01)");
                }

            if (localStorage)
                if (localStorage.getItem("Cuboids_4"))
                {
                    this.bg = localStorage.getItem("Cuboids_4");
                }
                else
                {
                    this.bg = "rgba(255,255,255,1)";
                    localStorage.setItem("Cuboids_4", "rgba(255,255,255,1)");
                }
            else
                if (window.localStorage.getItem("Cuboids_4"))
                    this.bg = window.localStorage.getItem("Cuboids_3");
                else
                {
                    this.bg = "rgba(255,255,255,1)";
                    window.localStorage.setItem("Cuboids_4", "rgba(255,255,255,1)");
                }
            this.rt = function ()
            {
                if (localStorage)
                {
                    localStorage.setItem("Cuboids_4", "rgba(255,255,255,1)");
                    localStorage.setItem("Cuboids_3", "rgba(255,255,255,0.01)");
                    localStorage.setItem("Cuboids_2", "#00fff0");
                    localStorage.setItem("Cuboids_1", "#00fff0");
                    localStorage.setItem("Cuboids_0", "#0000FF");
                }
                else
                {
                    window.localStorage.setItem("Cuboids_4", "rgba(255,255,255,1)");
                    window.localStorage.setItem("Cuboids_3", "rgba(255,255,255,0.01)");
                    window.localStorage.setItem("Cuboids_2", "#00fff0");
                    window.localStorage.setItem("Cuboids_1", "#00fff0");
                    window.localStorage.setItem("Cuboids_0", "#0000FF");
                }
                location.reload();
            }
            if (localStorage)
                if (localStorage.getItem("Cuboids_5"))
                {
                    this.a = parseInt(localStorage.getItem("Cuboids_5"));
                }
                else
                {
                    this.a = 100;
                    localStorage.setItem("Cuboids_5", 100);
                }
            else
                if (window.localStorage.getItem("Cuboids_5"))
                    this.a = parseInt(window.localStorage.getItem("Cuboids_5"));
                else
                {
                    this.a = 100;
                    window.localStorage.setItem("Cuboids_5", 100);
                }
            a = this.a;
        }
        function coc(v)
        {
            if (v != undefined)
            {
                if (v > a)
                {
                    for (var i = a; i < v; i++)
                    {
                        o[i] = new rect(Math.round(Math.random() * 99999) % innerWidth, Math.round(Math.random() * 9999) % innerHeight);
                    }
                }
                else
                {
                    o = o.slice(0, v);
                }
                a = v;
            }
            
            grad = ctxo.createLinearGradient(0, 0, 255, 1);
            if (q.color0 == q.color1)
            {
                grad.addColorStop(0, q.color1);
                grad.addColorStop(1, q.color2);
            }
            else
                if (q.color1 == q.color2)
                {
                    grad.addColorStop(0, q.color0);
                    grad.addColorStop(1, q.color1);
                }
                else
                {
                    grad.addColorStop(0, q.color0);
                    grad.addColorStop(0.5, q.color1);
                    grad.addColorStop(1, q.color2);
                }
            ctxo.fillStyle = grad;
            ctxo.rect(0, 0, 255, 1);
            ctxo.fill();
            imgd = ctxo.getImageData(0, 0, 255, 1).data;
            for (var i = 0; i < a; i++)
            {
                    o[i].c = g_color();
            }
            ctx.rect(0, 0, innerWidth, innerHeight);
            ctx.fillStyle = q.bg;
            ctx.fill();
        }
        window.onload = function ()
        {
            q = new u();
            var gui = new dat.GUI();
            c6 = gui.add(q, 'a', 1, 1000).name("Amount");
            c1 = gui.addColor(q, 'color0').name("Color 1");
            c2 = gui.addColor(q, 'color1').name("Color 2");
            c3 = gui.addColor(q, 'color2').name("Color 3");
            c4 = gui.addColor(q, 'bg').name("Background color");
            c5 = gui.addColor(q, 'color3').name("Clear color");

            gui.add(q, 'rt').name("Reset");
            c6.onFinishChange(function (v)
            {
                v = Math.round(v);
                if (localStorage)
                    localStorage.setItem("Cuboids_5", v);
                else
                    window.localStorage.setItem("Cuboids_5", v);
                ctx.clearRect(0, 0, innerWidth, innerHeight);
                coc(v);
            });
            c1.onChange(function (v)
            {
                if (localStorage)
                    localStorage.setItem("Cuboids_0", v);
                else
                    window.localStorage.setItem("Cuboids_0", v);
                coc();
            });
            c2.onChange(function (v)
            {
                if (localStorage)
                    localStorage.setItem("Cuboids_1", v);
                else
                    window.localStorage.setItem("Cuboids_1", v);
                coc();
            });
            c3.onChange(function (v)
            {
                if (localStorage)
                    localStorage.setItem("Cuboids_2", v);
                else
                    window.localStorage.setItem("Cuboids_2", v);
                coc();
            });
            c4.onChange(function (v)
            {
                if (localStorage)
                    localStorage.setItem("Cuboids_4", v);
                else
                    window.localStorage.setItem("Cuboids_4", v);
                coc();
            });
            c5.onChange(function (v)
            {
                if (localStorage)
                    localStorage.setItem("Cuboids_3", v);
                else
                    window.localStorage.setItem("Cuboids_3", v);
                coc();
            });
            var c = document.getElementById("c");
            c.height = innerHeight;
            c.width = innerWidth;
            ctx = c.getContext("2d");
            co = document.createElement("canvas");
            ctxo = co.getContext("2d");
            //

            grad = ctxo.createLinearGradient(0, 0, 255, 1);
            if (q.color0 == q.color1)
            {
                grad.addColorStop(0, q.color1);
                grad.addColorStop(1, q.color2);
            }
            else
                if (q.color1 == q.color2)
                {
                    grad.addColorStop(0, q.color0);
                    grad.addColorStop(1, q.color1);
                }
                else
                {
                    grad.addColorStop(0, q.color0);
                    grad.addColorStop(0.5, q.color1);
                    grad.addColorStop(1, q.color2);
                }
            ctxo.fillStyle = grad;
            ctxo.rect(0, 0, 255, 1);
            ctxo.fill();
            imgd = ctxo.getImageData(0, 0, 255, 1).data;
            //
            for (var i = 0; i < a; i++)
            {
                o[i] = new rect(Math.round(Math.random() * 99999) % innerWidth, Math.round(Math.random() * 9999) % innerHeight);
                //var xx = o[i].x;
                //var yy = o[i].y;

                //while (xx > 10 && yy > 10)
                //{

                //    xx /= 2;
                //    yy /= 2;
                //}
                //xx *= 2;
                //yy *= 2;
                //if (xx - cc.x > 0)
                //{
                //    console.log(xx < o[i].x);
                //    while (xx < o[i].x)
                //    {
                //        var t = Math.sqrt(Math.pow(xx - cc.x, 2) + Math.pow(yy - cc.y, 2));
                //        xx += (xx - cc.x) / 100; //o[i].d.x == "+" ? (t / 100) : -(t / 100);
                //        yy += (yy - cc.y) / 100; //o[i].d.y == "+" ? (t / 100) : -(t / 100);
                //        ctx.beginPath();
                //        var tt = t / 3;
                //        ctx.moveTo(xx + tt / 2, yy + tt / 2);
                //        ctx.lineTo(xx - tt / 2, yy + tt / 2);
                //        ctx.lineTo(xx - tt / 2, yy - tt / 2);
                //        ctx.lineTo(xx + tt / 2, yy - tt / 2);
                //        ctx.lineTo(xx + tt / 2, yy + tt / 2);
                //        ctx.fillStyle = "rgba(" + o[i].c.r + "," + o[i].c.g + "," + o[i].c.b + "," + o[i].c.a + ")";
                //        ctx.fill();
                //        ctx.lineWidth = 0.05;
                //        ctx.stroke();
                //    }
                //}
                //else
                //{
                //    console.log(xx > o[i].x);
                //    while (xx > o[i].x)
                //    {
                //        var t = Math.sqrt(Math.pow(xx - cc.x, 2) + Math.pow(yy - cc.y, 2));
                //        xx += (xx - cc.x) / 100; //o[i].d.x == "+" ? (t / 100) : -(t / 100);
                //        yy += (yy - cc.y) / 100; //o[i].d.y == "+" ? (t / 100) : -(t / 100);
                //        ctx.beginPath();
                //        var tt = t / 3;
                //        ctx.moveTo(xx + tt / 2, yy + tt / 2);
                //        ctx.lineTo(xx - tt / 2, yy + tt / 2);
                //        ctx.lineTo(xx - tt / 2, yy - tt / 2);
                //        ctx.lineTo(xx + tt / 2, yy - tt / 2);
                //        ctx.lineTo(xx + tt / 2, yy + tt / 2);
                //        ctx.fillStyle = "rgba(" + o[i].c.r + "," + o[i].c.g + "," + o[i].c.b + "," + o[i].c.a + ")";
                //        ctx.fill();
                //        ctx.lineWidth = 0.05;
                //        ctx.stroke();
                //    }
                //}
                ctx.beginPath();
            }
            ctx.rect(0, 0, innerWidth, innerHeight);
            ctx.fillStyle = q.bg;
            ctx.fill();
            render();
        }

        function render()
        {
            ctx.fillStyle = q.color3;
            ctx.rect(0, 0, innerWidth, innerHeight);
            ctx.fill();
            for (var i = 0, ol = o.length; i < ol; i++)
            {
                if ((o[i].x > innerWidth * 1.5 || o[i].y > innerHeight * 1.5 || o[i].y < 0 - innerHeight * 0.5 || o[i].x < 0 - innerWidth * 0.5) && Math.floor(Math.random() * 500) % 100 == 0)
                {
                    o[i] = new rect(Math.round(Math.random() * 99999) % 32 - 16 + cc.x, Math.round(Math.random() * 9999) % 32 - 16 + cc.y);
                }
                var t = Math.sqrt(Math.pow(o[i].x - cc.x, 2) + Math.pow(o[i].y - cc.y, 2));
                o[i].x += (o[i].x - cc.x) / 100 //o[i].d.x == "+" ? (t / 100) : -(t / 100);
                o[i].y += (o[i].y - cc.y) / 100//o[i].d.y == "+" ? (t / 100) : -(t / 100);
                ctx.beginPath();
                var tt = t / 6;
                ctx.moveTo(o[i].x + tt, o[i].y + tt);
                ctx.lineTo(o[i].x - tt, o[i].y + tt);
                ctx.lineTo(o[i].x - tt, o[i].y - tt);
                ctx.lineTo(o[i].x + tt, o[i].y - tt);
                ctx.lineTo(o[i].x + tt, o[i].y + tt);
                ctx.fillStyle = "rgba(" + o[i].c.r + "," + o[i].c.g + "," + o[i].c.b + "," + o[i].c.a + ")";
                ctx.fill();
                ctx.lineWidth = 0.05;
                ctx.stroke();
                //ctx.beginPath();
                //switch (o[i].d.x + o[i].d.y)
                //{
                //    case "++":
                //        ctx.moveTo(cc.x, cc.y);
                //        break;
                //    case "--":
                //        ctx.moveTo(cc.x, cc.y);
                //        break;
                //    case "+-":
                //        ctx.moveTo(cc.x, cc.y);
                //        break;
                //    case "-+":
                //        ctx.moveTo(cc.x, cc.y);
                //        break;
                //}
            }
            requestAnimationFrame(render);
        }
        function g_color()
        {
            try
            {

                var rr;
                var gg;
                var bb;
                var aa;
                rnd = Math.round(Math.random() * 9999) % 255;
                rr = imgd[rnd * 4 + 0];
                gg = imgd[rnd * 4 + 1];
                bb = imgd[rnd * 4 + 2];
                aa = 1;
                var c = { r: rr, g: gg, b: bb, a: aa };
                return c;
            }
            catch (i) { }
        }
        function or()
        {
            cc = new rect(innerWidth / 2, innerHeight / 2);
            c.height = innerHeight;
            c.width = innerWidth;
        }
    </script>
</head>
<body onresize="or();">
    <canvas id="c" style="left: 0; top: 0; margin: 0; position: fixed; color: #f00; background-color: #fff;z-index:-1; "></canvas>
</body>
</html>