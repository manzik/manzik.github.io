<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script>
        function p(x, y, r, c)
        {
            this.x = x;
            this.y = y;
            this.r = r;
            this.c = c;
            this.dir = { x: 0, y: 0 }
        }
        var sp = 0.05;
        //player object (circle)
        var pl_obj;
        //gravity circles
        var arr_gr_obj = [];
        var losdist = 120;
        var pl_obj_att = true;
        window.addEventListener("load", function ()
        {
            window.addEventListener("keydown", function (e)
            {
                if (e.keyCode == 32)
                {
                    pl_obj_att = !pl_obj_att;
                }
            });
            c = document.getElementById("c");
            c.height = innerHeight;
            c.width = innerWidth;
            ctx = c.getContext("2d");
            arr_gr_obj.push(new p(innerWidth / 2, innerHeight * 3 / 4, 80, "rgb(" + ((Math.random() * 255) >> 0) + "," + ((Math.random() * 255) >> 0) + "," + ((Math.random() * 255) >> 0) + ")"));
            arr_gr_obj.push(new p(Math.random() * innerWidth, innerHeight * 1 / 4, 80, "rgb(" + ((Math.random() * 255) >> 0) + "," + ((Math.random() * 255) >> 0) + "," + ((Math.random() * 255) >> 0) + ")"))
            var rand = Math.random() * 5;
            var x = innerWidth / 2 + Math.cos(rand) * 60;
            var y = innerHeight * 3 / 4 + Math.sin(rand) * 60;
            pl_obj = new p(x, y, 6, "rgb(" + ((Math.random() * 255) >> 0) + "," + ((Math.random() * 255) >> 0) + "," + ((Math.random() * 255) >> 0) + ")");
            pl_obj.sc = rand;
            pl_obj.f = 120;
            pl_obj.cw = true;
            rand += Math.PI / 20;
            var x2 = innerWidth / 2 + Math.cos(rand) * 60;
            var y2 = innerHeight * 3 / 4 + Math.sin(rand) * 60;
            attach_pl_obj(0);
            render();
        });
        function render()
        {
            calc_pos();
            ctx.clearRect(0, 0, innerWidth, innerHeight);
            //render arr_gr_obj
            for (var i = 0; i < arr_gr_obj.length; i++)
            {
                ctx.beginPath();
                ctx.arc(arr_gr_obj[i].x, arr_gr_obj[i].y, arr_gr_obj[i].r, 0, Math.PI * 2);
                ctx.closePath();
                ctx.fillStyle = arr_gr_obj[i].c;
                ctx.fill();
            }
            //render pl_obj
            ctx.beginPath();
            ctx.arc(pl_obj.x, pl_obj.y, pl_obj.r, 0, Math.PI * 2);
            ctx.closePath();
            ctx.fillStyle = pl_obj.c;
            ctx.fill();
            requestAnimationFrame(render);
        }
        function calc_pos()
        {
            if (pl_obj_att)
            {
                var grav_obj = arr_gr_obj[pl_obj.att];
                var dist = Math.sqrt(Math.pow(grav_obj.x - pl_obj.x, 2) + Math.pow(grav_obj.y - pl_obj.y, 2)) - grav_obj.r;
                var nesb = (grav_obj.y - pl_obj.y) / (grav_obj.x - pl_obj.x);
                //calc pl_obj gravity get farther
                //pl_obj.dir.y += -(grav_obj.y - pl_obj.y) * sp;
                //pl_obj.dir.x += -(grav_obj.x - pl_obj.x) * sp;
                //calc pl_obj gravity
                //pl_obj.dir.x += Math.abs((1 / dist) * (grav_obj.x - pl_obj.x)) < 10 ? (1 / dist) * (grav_obj.x - pl_obj.x) : 0;
                //pl_obj.dir.y += Math.abs((1 / dist) * (grav_obj.y - pl_obj.y)) < 10 ? (1 / dist) * (grav_obj.y - pl_obj.y) : 0;
                ///////////////////////////////////
                //pl_obj.sc += sp;
                //pl_obj.f += sp;
                //if (pl_obj.f > losdist)
                //{
                //    pl_obj.att = '';
                //    pl_obj.dir.x = -(pl_obj.x - (grav_obj.x + Math.cos(pl_obj.sc) * pl_obj.f));
                //    pl_obj.dir.y = -(pl_obj.y - (grav_obj.y + Math.sin(pl_obj.sc) * pl_obj.f));
                //}
                //pl_obj.dir.x = -(pl_obj.x - (grav_obj.x + Math.cos(pl_obj.sc) * pl_obj.f));
                //pl_obj.dir.y = -(pl_obj.y - (grav_obj.y + Math.sin(pl_obj.sc) * pl_obj.f));
                ///////////////////////////////
                pl_obj.dir.x += 1 / (Math.pow(dist, 2)) * (grav_obj.x - pl_obj.x);
                pl_obj.dir.y += 1 / (Math.pow(dist, 2)) * (grav_obj.y - pl_obj.y);
                pl_obj.sc += pl_obj.cw ? sp : -sp;
                pl_obj.f += pl_obj.f / 500;
                if (dist < 140)
                {
                    pl_obj.dir.x = -(pl_obj.x - (grav_obj.x + Math.cos(pl_obj.sc) * pl_obj.f)) / 6;
                    pl_obj.dir.y = -(pl_obj.y - (grav_obj.y + Math.sin(pl_obj.sc) * pl_obj.f)) / 6;
                }
                else
                {
                    pl_obj_att = false;
                }
                pl_obj.x += pl_obj.dir.x;
                pl_obj.y += pl_obj.dir.y;
            }
            else
            {
                for (var i = 0; i < arr_gr_obj.length; i++)
                {
                    if (i != pl_obj.att)
                    {
                        var d = Math.sqrt(Math.pow(arr_gr_obj[i].x - pl_obj.x, 2) + Math.pow(arr_gr_obj[i].y - pl_obj.y, 2));

                        if (d < 220)
                        {
                            pl_obj.f =  120;
                            pl_obj.sc = Math.atan2(arr_gr_obj[i].x - pl_obj.x, pl_obj.y-arr_gr_obj[i].y)+Math.PI/2;
                            pl_obj.att = i;
                            pl_obj_att = true;
                            a = pl_obj.dir.y / pl_obj.dir.x;
                            b = (pl_obj.y - arr_gr_obj[i].y) / (pl_obj.x - arr_gr_obj[i].x);
                            pl_obj.cw = a < b;
                            if (pl_obj.dir.x < 0 != 0 < (pl_obj.x - arr_gr_obj[i].x))
                            {
                                pl_obj.cw = !pl_obj.cw;
                            }
                        }
                    }
                }
                pl_obj.x += pl_obj.dir.x;
                pl_obj.y += pl_obj.dir.y;

            }
        }
        var d1, d2;
        function attach_pl_obj(x)
        {
            pl_obj.att = x;
        }
    </script>
</head>
<body>
    <canvas style="left:0;top:0;position:fixed;" id="c"></canvas>
</body>
</html>