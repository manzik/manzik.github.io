<!DOCTYPE html>
<html>
<head>
    <title>text transfer by sound - give | Manzik lab</title>
    <script src="riffwave.js"></script>
    <script src="ascii-binary-converter.min.js"></script>
    <script src="dat.gui.min.js"></script>
    <script>
        function give()
        {
            //A = new Audio("sound.wav");
            //n = parseInt(document.getElementById("ta").value);
            //context = new webkitAudioContext() || AudioContext();
            //    video = context.createMediaElementSource(A);
            //    analyser = context.createAnalyser();
            //    video.connect(analyser);
            //    analyser.connect(context.destination);
            //    analyser.smoothingTimeConstant = 0.3;
            //    arr = new Uint8Array(analyser.frequencyBinCount);
            //    for (var i = 0; i < 5; i++)
            //    {
            //        arr[i] = new Uint8Array(analyser.frequencyBinCount);
            //    }
            //si = setInterval(intervl, 200 * n);
            //A.loop = true;

            //var data = []; for (var i = 0; i < 15000; i++) data[i] = i%3*42;
            //var wave3 = new RIFFWAVE();
            //wave3.header.sampleRate = 15000;
            //wave3.Make(data);
            //var audio3 = new Audio(wave3.dataURI);
            //audio3.play();
            //raf();
            bina = ABC.toBinary(document.getElementById("ta").value);
            bina = bina.substring(0, bina.length);
            if (0)
            {
                var data2 = [];
                for (var i = 0; i < timing * 15 * (bina.length) ; i++)
                {
                    data2[i] = (bina[Math.floor(i / (timing * 15))] === "0" || bina[Math.floor(i / (timing * 15))] === " " || i < timing * 15) ? i % 5 * 32 : i % 17 * 8;
                }
                var wave4 = new RIFFWAVE();
                wave4.header.sampleRate = 15000;
                wave4.Make(data2);
                audio = new Audio(wave4.dataURI);
                audio.play();
            }
            else
            {
                beep(0);
                si = setInterval(sif, timing);
            }
            c++;
        }
        var t = true;
        var audio;
        var c = 0;
        var bool = false;
        function sif()
        {
            if (c < bina.length - 1)
            {
                if (bina[c] === "0" || bina[c] === " ")
                {
                    beep(0);
                }
                else
                {
                    beep(1);
                }
                c++;
            }
            else
            {
                clearInterval(si);
                c = 0;
            }
        }



        function beep(str)
        {
            
            
            
            
            if (str == 0)
            {
                audio2.pause();
                audio.currentTime = 0;
                audio.play();

            }
            else
            {
                audio.pause();
                audio2.currentTime = 0;
                audio2.play();

            }
        }
        function u()
        {
            this.d = 1000;
        }
        window.onload = function ()
        {
            q = new u();
            var gui = new dat.GUI();

            c1 = gui.add(q, "d", 15, 2000).name("Speed(ms)");
            timing = q.d;
            c1.onFinishChange(function (v)
            {
                //if (localStorage)
                //    localStorage.setItem("triangles_5", v);
                //else
                //    window.localStorage.setItem("triangles_5", v);
                timing = v;
                var data2 = []; for (var i = 0; i < timing * 15; i++) data2[i] = i % 5 * 32;
                var wave4 = new RIFFWAVE();
                wave4.header.sampleRate = 15000;
                wave4.Make(data2);
                audio = new Audio(wave4.dataURI);
                var data = []; for (var i = 0; i < timing * 15; i++) data[i] = i % 17 * 8;
                var wave3 = new RIFFWAVE();
                wave3.header.sampleRate = 15000;
                wave3.Make(data);
                audio2 = new Audio(wave3.dataURI);
            });
            var data2 = []; for (var i = 0; i < timing * 15; i++) data2[i] = i % 5 * 32;
            var wave4 = new RIFFWAVE();
            wave4.header.sampleRate = 15000;
            wave4.Make(data2);
            audio = new Audio(wave4.dataURI);
            var data = []; for (var i = 0; i < timing * 15; i++) data[i] = i % 17 * 8;
            var wave3 = new RIFFWAVE();
            wave3.header.sampleRate = 15000;
            wave3.Make(data);
            audio2 = new Audio(wave3.dataURI);

        };

        function raf()
        {
            var avg = 0;
            var array = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(array);
            for (i = 0, j = array.length; i < j; i++)
            {
                avg += array[i];
            }
            avg /= array.length;
            console.log(avg);
            requestAnimationFrame(raf);
        }
        var g = 0;
    </script>
</head>
<body>
    <textarea id="ta">5</textarea>
    <button onclick="give()">go</button>
</body>
</html>